<div class="list-header">
  <h2>Reservas</h2>

  <button mat-flat-button color="primary" (click)="toggleForm()">
    <mat-icon>add</mat-icon>
    Nueva reserva
  </button>
</div>

@if (showForm) {
  <app-reservation-form
    (saved)="onReservationCreated()"
    (cancel)="toggleForm()">
  </app-reservation-form>
}

<div class="table-container">
  <table
    mat-table
    [dataSource]="dataSource"
    matSort
    class="mat-elevation-z2 reservations-table">

    <!-- Cliente -->
    <ng-container matColumnDef="customerName">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Cliente</th>
      <td mat-cell *matCellDef="let row">{{ row.customerName }}</td>
    </ng-container>

    <!-- Email -->
    <ng-container matColumnDef="customerEmail">
      <th mat-header-cell *matHeaderCellDef>Email</th>
      <td mat-cell *matCellDef="let row">{{ row.customerEmail || '—' }}</td>
    </ng-container>

    <!-- Evento -->
    <ng-container matColumnDef="eventTitle">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Evento</th>
      <td mat-cell *matCellDef="let row">{{ row.eventTitle }}</td>
    </ng-container>

    <!-- Fecha del evento -->
    <ng-container matColumnDef="eventDate">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha</th>
      <td mat-cell *matCellDef="let row">
        {{ row.eventDate | date: 'shortDate' }}
      </td>
    </ng-container>

    <!-- Total -->
    <ng-container matColumnDef="total">
      <th mat-header-cell *matHeaderCellDef>Total</th>
      <td mat-cell *matCellDef="let row">
        {{ row.total | currency:'ARS':'symbol':'1.0-0' }}
      </td>
    </ng-container>

    <!-- Estado del pago -->
    <ng-container matColumnDef="status">
      <th mat-header-cell *matHeaderCellDef>Pago</th>
      <td mat-cell *matCellDef="let row">
        <mat-select
          [value]="row.status"
          (selectionChange)="updatePaymentStatus(row, $event)"
          [ngClass]="{
            'status-pending': row.status === 'PENDING',
            'status-paid': row.status === 'PAID',
            'status-cancelled': row.status === 'CANCELLED'
          }"
        >
          <mat-option value="PENDING">Pendiente</mat-option>
          <mat-option value="PAID">Pagado</mat-option>
          <mat-option value="CANCELLED">Cancelado</mat-option>
        </mat-select>
      </td>
    </ng-container>

    <!-- Fecha de pago -->
    <ng-container matColumnDef="paidAt">
      <th mat-header-cell *matHeaderCellDef mat-sort-header>Fecha de pago</th>
      <td mat-cell *matCellDef="let row">
        {{ row.paidAt ? (row.paidAt | date:'shortDate') : '—' }}
      </td>
    </ng-container>

    <!-- Header y rows -->
    <tr mat-header-row *matHeaderRowDef="cols"></tr>
    <tr mat-row *matRowDef="let row; columns: cols;"></tr>
  </table>
</div>
